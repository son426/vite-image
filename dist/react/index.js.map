{"version":3,"sources":["../../src/react/Image.tsx"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import { useState, type ImgHTMLAttributes, type CSSProperties } from \"react\";\nimport { preload } from \"react-dom\";\nimport type { ResponsiveImageData } from \"../types\";\n\n// placeholder 타입 정의 (Next.js Image 호환)\ntype PlaceholderValue = \"empty\" | \"blur\" | `data:image/${string}`;\n\n// ?vite-image import 결과 타입\ninterface BaseImageProps\n  extends Omit<\n    ImgHTMLAttributes<HTMLImageElement>,\n    \"src\" | \"srcSet\" | \"width\" | \"height\"\n  > {\n  // 핵심 변경: src는 무조건 최적화된 이미지 객체만 받음\n  src: ResponsiveImageData;\n  sizes?: string; // Optional: 제공되지 않으면 자동 계산\n  placeholder?: PlaceholderValue; // Next.js Image 호환: 'empty' | 'blur' | 'data:image/...'\n  blurDataURL?: string; // Optional: 커스텀 blur placeholder (src.blurDataURL보다 우선)\n  loading?: \"lazy\" | \"eager\"; // Next.js Image 호환: 이미지 로딩 방식\n  priority?: boolean; // Next.js Image 호환: true일 경우 높은 우선순위로 preload\n  onLoad?: (event: React.SyntheticEvent<HTMLImageElement, Event>) => void;\n  onError?: (event: React.SyntheticEvent<HTMLImageElement, Event>) => void;\n}\n\ninterface FillImageProps extends BaseImageProps {\n  fill: true;\n}\n\ninterface StandardImageProps extends BaseImageProps {\n  fill?: false | undefined;\n}\n\nexport type ImageProps = FillImageProps | StandardImageProps;\n\n/**\n * srcSet에서 breakpoints를 추출하여 sizes 문자열을 자동 생성\n * @param srcSet - \"url1 640w, url2 1024w, url3 1920w\" 형식의 문자열\n * @returns sizes 속성 문자열\n */\nfunction generateSizesFromSrcSet(srcSet?: string): string {\n  if (!srcSet) {\n    return \"100vw\";\n  }\n\n  // srcSet에서 width 값들 추출 (예: \"640w\", \"1024w\", \"1920w\")\n  const widthMatches = srcSet.match(/(\\d+)w/g);\n  if (!widthMatches || widthMatches.length === 0) {\n    return \"100vw\";\n  }\n\n  // width 값들을 숫자로 변환하고 정렬\n  const breakpoints = widthMatches\n    .map((match) => parseInt(match.replace(\"w\", \"\"), 10))\n    .sort((a, b) => a - b);\n\n  if (breakpoints.length === 0) {\n    return \"100vw\";\n  }\n\n  // breakpoints를 기반으로 sizes 문자열 생성\n  // 예: \"(max-width: 640px) 100vw, (max-width: 1024px) 100vw, 1920px\"\n  const sizeParts: string[] = [];\n\n  for (let i = 0; i < breakpoints.length; i++) {\n    const breakpoint = breakpoints[i];\n    if (i === breakpoints.length - 1) {\n      // 마지막 breakpoint는 최대 크기로 설정\n      sizeParts.push(`${breakpoint}px`);\n    } else {\n      // 중간 breakpoint들은 미디어 쿼리로 설정\n      sizeParts.push(`(max-width: ${breakpoint}px) 100vw`);\n    }\n  }\n\n  return sizeParts.join(\", \");\n}\n\nexport default function Image({\n  src, // 이제 이 src는 객체입니다.\n  fill = false,\n  sizes,\n  placeholder = \"empty\", // 기본값: empty (Next.js Image 호환)\n  blurDataURL: customBlurDataURL, // 사용자가 직접 제공한 blurDataURL (우선순위 높음)\n  loading, // loading prop (priority보다 낮은 우선순위)\n  priority = false, // 기본값: false (Next.js Image 호환)\n  className = \"\",\n  style,\n  onLoad,\n  onError,\n  ...props\n}: ImageProps) {\n  const [isImageLoaded, setIsImageLoaded] = useState(false);\n\n  // 1. 데이터 추출: src 객체에서 바로 꺼내씀 (병합 로직 제거)\n  const {\n    src: currentSrc,\n    srcSet: currentSrcSet,\n    blurDataURL: srcBlurDataURL, // 번들러가 생성한 blurDataURL\n    width: currentWidth,\n    height: currentHeight,\n  } = src;\n\n  // blurDataURL 우선순위: prop으로 제공된 것 > src 객체의 것\n  const blurDataURL = customBlurDataURL ?? srcBlurDataURL;\n\n  // 2. loading 속성 결정: 우선순위 priority > loading prop > 기본값('lazy')\n  const loadingAttr = priority ? \"eager\" : (loading ?? \"lazy\");\n\n  // 3. sizes 자동 계산: 제공되지 않으면 srcSet 기반으로 자동 생성\n  const computedSizes =\n    sizes ?? (fill ? \"100vw\" : generateSizesFromSrcSet(currentSrcSet));\n\n  // 4. Priority 처리: priority={true}일 때 preload\n  if (priority && currentSrc) {\n    preload(currentSrc, {\n      as: \"image\",\n      fetchPriority: \"high\",\n      ...(currentSrcSet ? { imageSrcSet: currentSrcSet } : {}),\n      ...(computedSizes ? { imageSizes: computedSizes } : {}),\n    });\n  }\n\n  // 5. placeholder 처리 (Next.js Image 호환)\n  const getPlaceholderSrc = (): string | undefined => {\n    if (placeholder === \"empty\") {\n      return undefined;\n    }\n    if (placeholder === \"blur\") {\n      return blurDataURL;\n    }\n    // data:image/... 형식의 직접 제공된 placeholder\n    if (placeholder.startsWith(\"data:image/\")) {\n      return placeholder;\n    }\n    // 기본값: empty\n    return undefined;\n  };\n\n  const placeholderSrc = getPlaceholderSrc();\n  const hasShowPlaceholder = !!placeholderSrc;\n\n  // 5. 컨테이너 스타일 계산 (기존 로직 유지)\n  const containerStyle: CSSProperties = fill\n    ? {\n        position: \"absolute\",\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        width: \"100%\",\n        height: \"100%\",\n        overflow: \"hidden\",\n      }\n    : {\n        position: \"relative\",\n        width: \"100%\",\n        overflow: \"hidden\",\n        // Standard 모드일 때 aspect-ratio 처리\n        ...(currentWidth && currentHeight\n          ? { aspectRatio: `${currentWidth} / ${currentHeight}` }\n          : {}),\n      };\n\n  const mergedContainerStyle = { ...containerStyle, ...style };\n\n  // 6. 실제 이미지 스타일 (기존 로직 유지)\n  const imgStyle: CSSProperties = {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    width: \"100%\",\n    height: \"100%\",\n    objectFit: \"cover\",\n  };\n\n  // 7. Placeholder 스타일 (blur 모드일 때만 blur 효과 적용)\n  const placeholderStyle: CSSProperties = {\n    ...imgStyle,\n    transition: \"opacity 500ms ease-out\",\n    opacity: isImageLoaded ? 0 : 1,\n    zIndex: 1,\n    pointerEvents: \"none\",\n\n    // blur placeholder일 때만 blur 효과 적용\n    ...(placeholder === \"blur\"\n      ? {\n          filter: \"blur(20px)\",\n          transform: \"scale(1.1)\",\n        }\n      : {}),\n  };\n\n  return (\n    <div className={className} style={mergedContainerStyle}>\n      {/* 실제 이미지 */}\n      <img\n        {...props}\n        src={currentSrc}\n        srcSet={currentSrcSet}\n        sizes={computedSizes}\n        width={fill ? undefined : currentWidth}\n        height={fill ? undefined : currentHeight}\n        loading={loadingAttr}\n        fetchPriority={priority ? \"high\" : undefined}\n        onLoad={(e) => {\n          setIsImageLoaded(true);\n          onLoad?.(e);\n        }}\n        onError={onError}\n        style={{ ...imgStyle, zIndex: 0 }}\n      />\n\n      {/* Placeholder 레이어 (placeholder prop에 따라 표시) */}\n      {hasShowPlaceholder && (\n        <img\n          src={placeholderSrc}\n          alt=\"\"\n          aria-hidden=\"true\"\n          style={placeholderStyle}\n        />\n      )}\n    </div>\n  );\n}\n"]}